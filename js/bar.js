checkJquery(); var pageUrl=window.location.href; var data='{"projectId":"jO0hHVnXMxfG6i8Ujh+Zaw==","projectKey":"VW50aXRsZSBQcm9qZWN0MTYwODc4NTk2MDM0OA==","pageUrl":"'+pageUrl+'"}'; let storage=Object.keys(localStorage).filter( (key)=> key.startsWith('cp-') ) .map( (key)=> localStorage[key] ); var xhr=new XMLHttpRequest(); var popupData ; var promise; function getJsURL() { xhr.addEventListener("readystatechange", function() { if (this.readyState === 4) { var response=JSON.parse(xhr.responseText); if(response.status){ popupData=response.data; if(popupData.js!=undefined){ popupData.js.forEach(appendScript); }; if(popupData.css!=undefined){ popupData.css.forEach(appendStyle); }; promise=new Promise(resolve => { if(popupData.jsfuntion != undefined){ resolve(popupData.jsfuntion); } else { resolve(false); } }); } } }); xhr.open("POST", "https://announcement.cronberry.com/api/creative/user-js-load"); xhr.setRequestHeader("authorization", "Basic Y3JvbmJlcnJ5QHVzZXJuYW1lOmNyb25iZXJyeUBwYXNzd29yZA=="); xhr.setRequestHeader("content-type", "application/json"); xhr.setRequestHeader("storage", storage); xhr.send(data); } function appendScript(value) { var script = document.createElement('script'); script.src = value; document.body.appendChild(script); } getJsURL(); function appendScript(value) { var script = document.createElement('script') ; script.src = value; document.body.appendChild(script); } function appendStyle(value) { var headID = document.getElementsByTagName('head')[0]; var link = document.createElement('link'); link.type = 'text/css'; link.rel = 'stylesheet'; headID.appendChild(link); link.href = value; } function checkJquery(){ if (typeof jQuery === 'undefined') { appendJquery(); } else { if(Number(window.jQuery.fn.jquery.replaceAll('.','')) < 127){ appendJquery(); appendInlineScript('var cpQ=jQuery.noConflict();'); } else { appendInlineScript('var cpQ=jQuery'); } } } function appendJquery(){ var script=document.createElement('script') ; script.src = 'https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'; document.body.appendChild(script); } function appendInlineScript(js){ var script=document.createElement("script"); script.innerHTML = js; document.body.appendChild(script); } function afterJsLoad(value){ appendInlineScript(value); popupData.htmlData.forEach(element => { jQuery(element.replace(/<embed/g, '<img').replace(/<(\/)?js>/g, '<$1script>')).appendTo(document.body); }); } function setLocalStorage(id, days){ var time = new Date().setDate(new Date().getDate()+days); localStorage.setItem('cp-'+id,'cronberry-'+id+':'+time); }
